name: decoder/suricata/0

sources:
  - decoder/json/0

metadata:
  module: suricata
  compatibility: <= v7
  author:
    name: Wazuh Inc, info@wazuh.com
    date: Nov 18 2022
  references:
    - https://suricata.readthedocs.io/en/suricata-6.0.8/output/eve/eve-json-format.html?highlight=eve%20format
  title: Suricata decoder
  description: Decoder for Suricata solution

definitions:
  is_good_appProto: +s_ne/~json.app_proto/failed AND +s_ne/~json.app_proto/template AND +s_ne/~json.app_proto/template-rust

check:
  - ~json.event_type: +ef_exists

normalize:
  - map:
      - event.kind: event
      - event.category: +a_append/network

  - map:
      - ~json.app_proto: +s_lo/$~json.app_proto

  - check: $is_good_appProto
    map:
      - network.protocol: $~json.app_proto

  - check:
      - ~json.app_proto: +s_eq/ftp-data
    map:
      - network.protocol: ftp

  - map:
      - source.address: $~json.src_ip
      - source.ip: $~json.src_ip
      - source.port: $~json.src_port
      - destination.address: $~json.dest_ip
      - destination.ip: $destination.address
      - destination.port: $~json.dest_port
      - network.transport: $~json.proto

      # flow_id
      # target_field: dns.question.registered_domain
      # target_subdomain_field: dns.question.subdomain
      # target_etld_field: dns.question.top_level_domain

      - ~json.event_type: +s_lo/$~json.event_type
      - ~json.netwrok.transport: +s_lo/$~json.network.transport
      - ~json.proto: +s_lo/$~json.proto

      - destination.mac: $~json.ether.dest_mac
      - source.mac: $~json.ether.src_mac
      - destination.packets: $~json.flow.pkts_toclient
      - source.packets: $~json.flow.pkts_toserver
      - destination.bytes: $~json.flow.bytes_toclient
      - source.bytes: $~json.flow.bytes_toserver
      - event.start: $~json.flow.start
      - event.end: $~json.flow.end

  - check:
      - ~json.flow.state: +s_eq/new
    map:
      - event.type: +a_append/end
